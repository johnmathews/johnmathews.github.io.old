<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="zsh was loading significantly slower than bash, so I used profiling to see what was slowing things down">
    <meta name="keywords" content="bash,profiling,shell,unix,zsh">

    <meta name="twitter:card" value="Summary_large_image">
    <meta name="twitter:domain" content="http://johnmathews.eu">
    <meta name="twitter:title" content="A faster shell ">
    <meta name="twitter:description" content="zsh was loading significantly slower than bash, so I used profiling to see what was slowing things down">
    <meta name="twitter:creator" content="@johnmathews">
    <meta name="twitter:image" content="./images/zsh_order_blind_profiling.jpg">


    <meta property="og:title" content="A faster shell" />       
    <meta property="og:type" content="article" />
    <meta property="og:url" content="./shell.html" />
    <meta property="og:site_name" content="John Mathews' blog" />
    <meta property="og:image" content="./images/zsh_order_blind_profiling.jpg" />
    <meta property="og:description" content="zsh was loading significantly slower than bash, so I used profiling to see what was slowing things down" />
    <meta property="fb:app_id" content="871943349626197" />

    <link rel="icon" href="./favicon.png">

    <title> A faster shell - John Mathews </title>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->



  </head>

  <body>
    <a name="top"></a>

    <!-- Header -->
    <div class="header-container gradient">

 
    <!-- Static navbar -->
    <div class="container" style="width:100%;float:left;display:block;">
      <div class="header-nav" >
        <div class="header-logo" >
          <a class="pull-left hidden-xs" href="."><img class="mr20" src="./images/logo.jpeg" alt="John Mathews" height="115" width="115"> </a>
          <div class="header-text">
            <a class="pull-left" style='margin-left:10px;' href="."> Hello! I'm John </a>
            <div class="anon" style='text-align:right; padding-right:10px;' >
              <a class="active" href="./pages/about.html">About</a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /Static navbar -->

    <!-- Header -->
    <!-- /Header -->
    </div>

    <!-- Content -->
    
    <div class="container content">
        <div> 
            <h1> A faster&nbsp;shell </h1> 
        </div>
        
 
        <div class="summary">
            <p>zsh was loading significantly slower than bash, so I used profiling to see what was slowing things&nbsp;down</p>
        </div>
        
        <div class="article_image">
            <img src="/images/zsh_order_blind_profiling.jpg" alt="what zsh spends its time doing when it starts" />
        </div>

        <div class="article_author"> 
            By John Mathews </br>
            Category: <a href="./category/tools.html">Tools</a>
        </div>
        
        <div class="article_date"> 
            Feb 14 2019 
        </div>
        
        <p>Opening up a new shell was annoyingly slow. Not terrible, but enough to notice. Its a&nbsp;niggle.</p>
<p>I wanted to find out which components were causing the most delay, so I used
<code>time</code> to measure how long it took to launch a shell. Even though shells
might appear to be part of the low level &#8216;guts&#8217; of a computer, each shell is
just an executable and can be treated as&nbsp;such.</p>
<p>To measure the startup speed of your shell,&nbsp;do:</p>
<div class="highlight"><pre><span></span><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> <span class="m">10</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span> /usr/bin/time <span class="nv">$SHELL</span> -i -c exit<span class="p">;</span> <span class="k">done</span>
</pre></div>


<p><img alt="zsh profile" src="./images/zsh_startup_speed.jpg"></p>
<p>This shows that it takes 0.84 seconds to start <code>zsh</code> - not terrible, but not&nbsp;great:</p>
<p>You can compare the performance of different shells by replacing <code>$SHELL</code> with
<code>zsh</code>, <code>bash</code>, <code>fish</code> etc.</p>
<p>Here are the results if I used <code>BASH</code> instead of <code>zsh</code> - 9.3x faster! (but
without useful tools and plugins):
<img alt="bash profile" src="./images/bash_startup_speed.jpg"></p>
<p>Now that I can measure how long it takes to start, it would be useful to know
which proccesses are causing the greatest delays. This could be done with
something like <code>zsh -xv</code> which enables verbose output and xtrace. This creates
a tonne of output, but doesnt inlcude timestamps. All I really want is
a summary of how much time each subproccess required to run, i.e. an order blind&nbsp;profiler.</p>
<p>Add <code>zmodload zsh/zprof</code> at the start of <code>.zshrc</code> and <code>zprof</code> at the very end.
Now when I start <code>zsh</code> I see the&nbsp;following: </p>
<p><img alt="zsh startup components" src="./images/zsh_order_blind_profiling.jpg"></p>
<p>Next steps - make virtualenvwrapper run faster, or asyncronously, or
not at&nbsp;all&#8230;</p>
<p>Update:
<code>virtualenvwrapper</code> is the biggest cause of slow loading. Using the <a href="https://virtualenvwrapper.readthedocs.io/en/latest/install.html">lazy
loadin</a> option decreased loading time by&nbsp;0.3s</p>
<p><img alt="zsh profile" src="./images/zsh_startup_speed_lazy_load.jpg"></p>

        <div id="sub_req">
            </br> Thanks for reading! If you'd like to know when I publish something new, please <a href="./pages/subscribe" >subscribe!</a>
            <br>
            <br>
        <a href="http://twitter.com/share?url=http%3A//johnmathews.eu/shell.html&text=Measure%20how%20slow%20you%20shell%20is%20and%20find%20out%20which%20components%20are%20causing%20the%20biggest%20delays&via=johnmathews" target="_blank" ><img src="./images/twitter_logo.png" alt="Twitter" style="margin-bottom:0px;margin-top:10px;width:40px;height:40px;display:inline-block"></a>
        &nbsp; &nbsp;
        <a href="http://www.facebook.com/sharer/sharer.php?u=http%3A//johnmathews.eu/shell.html" target="_blank"><img src="./images/facebook_logo.png" alt="Facebook" style="margin-bottom:0px;margin-top:10px;width:40px;height:40px;display:inline-block"></a>
        &nbsp; &nbsp;
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A//johnmathews.eu/shell.html&title=A%20faster%C2%A0shell&summary=zsh%20was%20loading%20significantly%20slower%20than%20bash%2C%20so%20I%20used%20profiling%20to%20see%20what%20was%20slowing%20things%C2%A0down&source=http%3A//johnmathews.eu/shell.html" target="_blank"><img src="./images/linkedin_logo.png" alt="Email" style="margin-bottom:0px;margin-top:10px;width:40px;height:40px;display:inline-block"></a>
        &nbsp; &nbsp;
        <a href="mailto:?subject=A%20faster%C2%A0shell&amp;body=http%3A//johnmathews.eu/shell.html" target="_blank"><img src="./images/email_logo.png" alt="Email" style="margin-bottom:0px;margin-top:10px;width:40px;height:40px;display:inline-block"></a>
         </div>
        
         <div class="neighbors">
             <ul>
                     <li class="previous_article">
                         <a href="./rys-git-tutorial.html">
                             Ry&#8217;s Git&nbsp;Tutorial
                         </a>
                     </li>
                 
            </ul>
        </div>
    
        <div> 

<!--
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://johnmathews.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->                   
        </div>
    </div>    

    <!-- Footer -->
    <div class="footer">

 <a   <a  class="active" href="./pages/subscribe.html">Subscribe</a>   
      <span style="display:inline-block; width: 2%;"></span>
      |
      <span style="display:inline-block; width: 2%;"></span>
      <a href=".">Home</a> 
      <span style="display:inline-block; width: 2%;"></span>
      |
      <span style="display:inline-block; width: 2%;"></span>
      <a href="./archives.html">Archives</a> 
      <span style="display:inline-block; width: 2%;"></span>
      |
      <span style="display:inline-block; width: 2%;"></span>
      <a href="./tags.html">Tags</a>

    </div>
    <!-- /Footer -->

    <!-- /Content --> 

    <!-- Stylesheets -->
    <link async rel="stylesheet" href="./theme/webassets-external/5f3d01727f6012a80d07a80d177230d1_bootstrap.css">
    <link async rel="stylesheet" href="./theme/webassets-external/c01625840139bd96539823ec2d9bfa36_fonts.css">
    <link async rel="stylesheet" href="./theme/webassets-external/2d09370fbbcfe8a0ccb320338e4d3dd3_style.css">
    <link async rel="stylesheet" href="./theme/webassets-external/f33dd54a5edc2ac8b54bdb904a6a0f43_pygment.css">
    <link async rel="stylesheet" href="./theme/webassets-external/7fc5981923aacfb9134c260b7ea32233_lightbox.css">

    <script async src="./theme/webassets-external/b3976572aef2ec3a45079dd346d6ce68_lightbox-plus-jquery.js"></script>

    <!-- plot.ly js -->
    <script async src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script>
      lightbox.option({
        'resizeDuration': 400,
        'wrapAround': true,
        'imageFadeDuration': 300,
        'disableScrolling': true,
        'showImageNumberLabel': true,
        'positionFromTop': 50
      })
    </script>
  </body>
</html>