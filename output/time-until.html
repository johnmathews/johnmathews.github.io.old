<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Time Until In a previous post I described how I was introduced to CoffeeScript via Übersicht, the desktop widget app for OS X, and eventually published the “Time Since” widget. Seeing a few people...">
        <meta name="keywords" content="AppleScript, CoffeeScript, JavaScript, Time Until, Übersicht">
        <link rel="icon" href="./favicon.ico">

        <title>Time&nbsp;Until - John Mathews</title>

        <!-- Stylesheets -->
        <link href="./theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="./theme/css/fonts.css" rel="stylesheet">
        <link href="./theme/css/nest.css" rel="stylesheet">
        <link href="./theme/css/pygment.css" rel="stylesheet">
        <link href="./theme/css/lightbox.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Google Analytics -->
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-82253540-1', 'auto');
          ga('send', 'pageview');
        </script>
        <!-- /Google Analytics -->


    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo ">
                        <a class="pull-left hidden-xs" href="./"><img class="mr20" src="./images/logo.jpeg" alt="logo"> </a>
                        <a class="pull-left" href="./">John Mathews </a>
                    </div>
                    <div class="nav pull-right">
                            <a  href="./pages/about.html">About</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    
    <div class="container content">
        <h1>Time&nbsp;Until</h1>
<p>In a <a href="http://www.johnmathews.eu/2016/07/30/time-since/">previous post</a> I
described how I was introduced to CoffeeScript via
<a href="http://tracesof.net/uebersicht/">Übersicht</a>, the desktop widget app for <span class="caps">OS</span> X, and eventually published the &#8220;<a href="http://tracesof.net/uebersicht-widgets/#time_since">Time Since</a>&#8221;&nbsp;widget.</p>
<p>Seeing a few people download the widget was really satisfying, and I was
soon wondering what else I could publish. As a pragmatic engineer, it
seemed clear to me what the next widget should do: If my first widget
calculated the time since an event, the next should calculate the time
until an event. I set out to create the companion to &#8220;Time Since&#8221; and
improve upon the underlying&nbsp;code.</p>
<p>My first code design choice was to cut out the use of an Apple Script
and calculated everything in one CoffeeScript file. It would be more
efficient and easier to&nbsp;read.</p>
<p>Unfortunately I soon began to realise why the original widget I&#8217;d based
&#8220;Time Since&#8221; on had used AppleScript to calculate the time elapsed.
Date-Times are fiddly to work with in many languages, and this is true
in JavaScript&nbsp;also.</p>
<p>My code began to look increasingly like spaghetti as I tried to achieve
6 key&nbsp;features:</p>
<ol>
<li>Calculate the number of months and days between two dates
    (complicated by the varying number of days in different&nbsp;months)</li>
<li>Add the option to specify the level of detail in the output text (to
    the minute, to the hour, to the day,&nbsp;etc.)</li>
<li>Remove any 0 amounts from the output (&#8220;2 Months and 5 Hours&#8221; not &#8220;2
    Months, 0 Days and 5&nbsp;Hours&#8221;)</li>
<li>Add the option to abbreviate times (&#8216;years&#8217; → &#8216;y&#8217;, &#8216;hours&#8217; → &#8216;h&#8217;,
    &#8216;and&#8217; → &#8216;&amp;&#8217;,&nbsp;etc.)</li>
<li>Output a grammatically correct sentence (correct pluralisation and
    comma separated terms, with an &#8220;and&#8221; between the last two&nbsp;terms)</li>
<li>Prepend and append users defined&nbsp;strings</li>
</ol>
<p>After a few frustrating hours, it was clear that it would be a lot
easier to modify the existing AppleScript rather than reinvent the wheel
in JavaScript. I decided to use it instead of using only JavaScript as I
knew the AppleScript file could correctly consider the number of days in
the months between the 2 dates (feature 1), and it contains a function
to pluralise the correct parts of the string (feature&nbsp;5).</p>
<p>The remaining features were added by using a combination of
if statements and arrays. The if statements simply ask if an amount
is equal to zero. If not, then it&#8217;s appended to an array of terms to
include in the output. At the end of this code chunk it&#8217;s possible to
ask how many non-zero terms to include in the output. An array with
length one less than the number of output terms is created and filled
with commas with an &#8216;and&#8217; in the final&nbsp;position.</p>
<p>The two arrays are combined in the correct order by looping through the
index of the longer array and appending each term to a final array. The
final array is the&nbsp;output.</p>
<p><em><span class="quo">&#8216;</span><a href="http://tracesof.net/uebersicht-widgets/#time_until">Time Until</a>&#8217;</em> can
be downloaded from the <a href="http://tracesof.net/uebersicht/">Übersicht</a>
<a href="http://tracesof.net/uebersicht-widgets/">widgets gallery</a>. I think
another useful feature would be an option to specify the output only in
terms of a chosen amount, such as weeks or days. Maybe I&#8217;ll do that in
the&nbsp;future.</p>

    
        <div class="neighbors">
             <ul>
                     <li class="previous_article">
                         <a href="./how-to-wake-up-early.html">
                             How to wake up&nbsp;early
                         </a>
                     </li>
                 
                     <li class="next_article">
                         <a href="./spare-time.html">
                             Spare&nbsp;time
                         </a>
                     </li>
            </ul>
        </div>
    
        <div> 

    <div class="comments">
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'johnmathews';
                var disqus_identifier = 'time-until.html';
                var disqus_url = './time-until.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
        <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

<!--
<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://johnmathews.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->                           </div>
    </div>    
        <!-- /Content --> 
        
        <script src="./theme/js/lightbox-plus-jquery.js"></script>
        <script>
            lightbox.option({
              'resizeDuration': 400,
              'wrapAround': true,
              'imageFadeDuration': 300,
              'disableScrolling': true,
              'showImageNumberLabel': true,
              'positionFromTop': 50
            })
        </script>
    </body>
</html>