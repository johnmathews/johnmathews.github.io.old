<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="|CODE0| I&#39;ve recently been doing a lot of work reconciling financial ledgers. The python code below shows an automated workflow to import, process and report on the reconciliation of a Trial...">
        <meta name="keywords" content="Accounting, Finance, Journals, Python">
        <link rel="icon" href="/favicon.ico">

        <title>Reconciliation of a Trial Balance to a General Ledger - John Mathews</title>

        <!-- Stylesheets -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="/theme/css/fonts.css" rel="stylesheet">
        <link href="/theme/css/nest.css" rel="stylesheet">
        <link href="/theme/css/pygment.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="/"><img class="mr20" src="/images/logo.jpeg" alt="logo">John Mathews</a>
                    </div>
                    <div class="nav pull-right">
                            <a  href="/pages/about.html">About</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <!--
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">   
                  <div class="header-content">
                     <h1 class="header-title">Reconciliation of a Trial Balance to a General Ledger</h1>
                      <p class="header-date">By <a href="/author/jm.html">JM</a>, Jan 03 2017, in category <a href="/category/data-analysis-finance.html">Data analysis, finance</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
<a href="/tag/accounting.html">Accounting</a>, <a href="/tag/finance.html">Finance</a>, <a href="/tag/journals.html">Journals</a>, <a href="/tag/python.html">Python</a>                      </p>
                  </div> 
              </div>
        </div>
    </div>
    -->
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>
<script src="http://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

|CODE0|
</p>

<div class="cell border-box-sizing text_cell rendered">

I've recently been doing a lot of work reconciling financial ledgers.
The python code below shows an automated workflow to import, process and
report on the reconciliation of a Trial Balance (TB) to a General Ledger
(GL).

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

I'm using fake data, but the script would work fine with real data if
the fields were mapped appropriately to the names used below. A real
data set would have additional fields that needed to be considered but
these vary depending on the size and type of business being analysed.
Therefore the fake GL and TB used here are simple and generic.
Additional fields, such as entity code, transaction status, approver,
time stamps, etc can be added quickly and simply. <!--more-->

<form action="javascript:code_toggle()">
<input type="submit" value="show/hide script">
</form>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Set-up the notebook, Import data**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[1\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    # Import libraries
    import pandas as pd
    import random

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[2\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    # Import (possibly incomplete and/or inaccurate) data
    gl = pd.read_csv('glx.txt', sep = '|')
    tb = pd.read_csv('tbx.txt', sep = '|')

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

### Create reconciliation report {#Create-reconciliation-report}

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Calculate net movement for each account in the ledger data**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[3\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    gl_move = gl[['Account','Functional_Amount']]
    gl_move = gl_move.groupby(['Account']).sum().round(2)
    gl_move.reset_index(level=0, inplace=True)
    gl_move.columns = ['Account','GL_Movement']
    gl_move.sort_values(by = 'Account')
    gl_move.set_index('Account', inplace = True)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Calculate the movement for each account in the trial balance data**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[4\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    tb['TB_Movement'] = ( tb['Balance c/f'] - tb['Balance b/f'] ).round(2)
    tb.set_index('Account', inplace = True)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Compare each accounts movement in the ledger data and the trial
balance and write the result to a report containing the reconciliation
results for all accounts**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[5\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    Rec_report = tb.merge(gl_move, how = 'outer', left_index = True, right_index = True)
    Rec_report['difference'] = Rec_report.TB_Movement - Rec_report.GL_Movement
    Rec_report['difference'] = Rec_report['difference'].astype(float)
    Rec_report['Balance date'] = Rec_report['Balance date'].astype(str).str[0:8]
    Rec_report.to_csv('All_accounts.txt', sep='|', encoding='utf-8', header=True, index=True)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Put the accounts which do not reconcile into a separate report**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[6\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    Unreconciled = Rec_report[Rec_report.difference != 0]
    Unreconciled = Unreconciled.reindex(Unreconciled.difference.abs().sort_values(ascending = False).index)
    Unreconciled.to_csv('Unreconciled_accounts.txt', sep='|', encoding='utf-8', header=True, index=True)
    Unreconciled

</div>

</div>

</div>

</div>

<div class="output_wrapper">

<div class="output">

<div class="output_area">

<div class="prompt output_prompt">

Out\[6\]:

</div>

<div
class="output_html rendered_html output_subarea output_execute_result">

<div>

<table class="dataframe" border="1">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Type
</th>
<th>
Balance b/f
</th>
<th>
Balance c/f
</th>
<th>
Balance date
</th>
<th>
TB\_Movement
</th>
<th>
GL\_Movement
</th>
<th>
difference
</th>
</tr>
<tr>
<th>
Account
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
<th>
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
ACP00081
</th>
<td>
P&L
</td>
<td>
0.00
</td>
<td>
-16279.96
</td>
<td>
20161231
</td>
<td>
-16279.96
</td>
<td>
-17017.89
</td>
<td>
737.93
</td>
</tr>
<tr>
<th>
ACB00082
</th>
<td>
BS
</td>
<td>
760.09
</td>
<td>
-4041.02
</td>
<td>
20161231
</td>
<td>
-4801.11
</td>
<td>
-4063.18
</td>
<td>
-737.93
</td>
</tr>
<tr>
<th>
ACP00071
</th>
<td>
P&L
</td>
<td>
0.00
</td>
<td>
-28547.84
</td>
<td>
20161231
</td>
<td>
-28547.84
</td>
<td>
-29260.31
</td>
<td>
712.47
</td>
</tr>
<tr>
<th>
ACB00091
</th>
<td>
BS
</td>
<td>
628.24
</td>
<td>
3054.74
</td>
<td>
20161231
</td>
<td>
2426.50
</td>
<td>
3138.97
</td>
<td>
-712.47
</td>
</tr>
<tr>
<th>
ACP00017
</th>
<td>
P&L
</td>
<td>
654.01
</td>
<td>
24449.74
</td>
<td>
20161231
</td>
<td>
23795.73
</td>
<td>
23123.06
</td>
<td>
672.67
</td>
</tr>
<tr>
<th>
ACB00076
</th>
<td>
BS
</td>
<td>
768.49
</td>
<td>
-48456.11
</td>
<td>
20161231
</td>
<td>
-49224.60
</td>
<td>
-48551.93
</td>
<td>
-672.67
</td>
</tr>
<tr>
<th>
ACB00037
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
nan
</td>
<td>
NaN
</td>
<td>
19808.54
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
ACP00001
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
nan
</td>
<td>
NaN
</td>
<td>
-3817.92
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
ACP00041
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
nan
</td>
<td>
NaN
</td>
<td>
-14365.77
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
ACP00046
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
nan
</td>
<td>
NaN
</td>
<td>
1825.79
</td>
<td>
NaN
</td>
</tr>
<tr>
<th>
ACP00086
</th>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
NaN
</td>
<td>
nan
</td>
<td>
NaN
</td>
<td>
-7263.37
</td>
<td>
NaN
</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing text_cell rendered">

<div class="prompt input_prompt">

</div>

<div class="inner_cell">

<div class="text_cell_render border-box-sizing rendered_html">

**Create a report containing summary details about the data being
reconciled**

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[7\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    # Accounts not in the TB but in the GL
    Accounts_not_in_TB = Unreconciled[Unreconciled.TB_Movement.isnull() == True]

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[8\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    # Accounts in the TB where TB_Movement isn't matched in the GL
    Missing_journals = Unreconciled[(Unreconciled.GL_Movement.isnull() == True)|(Unreconciled.difference.isnull() ==False)]

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[9\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    Total_Accounts = len(Rec_report)
    Num_Rec_Accounts = Total_Accounts - len(Unreconciled)
    Num_Unrec_Accounts = len(Unreconciled)
    Rec_Fraction = Num_Rec_Accounts / Total_Accounts
    Unrec_Fraction = Num_Unrec_Accounts / Total_Accounts

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[10\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    with open("Report.txt", "w") as text_file:
        print('The data contains',Total_Accounts, 'accounts', file=text_file)
        print(Num_Rec_Accounts, 'accounts reconcile (', round(Rec_Fraction*100,2), '%)\n', file=text_file)
        print(Num_Unrec_Accounts, 'accounts do not reconcile (', round(Unrec_Fraction*100,2), '%)', file=text_file)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[11\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    with open("Report.txt", "a") as text_file:
        print('There are', len(Accounts_not_in_TB), 'accounts in the GL and not in the TB. (', round(100*(len(Accounts_not_in_TB)/Num_Unrec_Accounts),2), '% of unreconciled accounts)', file=text_file)
        print('There are', len(Missing_journals), 'accounts with journals missing (', round(100*(len(Missing_journals)/Num_Unrec_Accounts),2), '% of unreconciled accounts)', file=text_file)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[12\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    net_diff = round(Unreconciled[Unreconciled.difference.isnull() == False].difference.sum(),2)
    with open("Report.txt", "a") as text_file:
        print('The net of all the differences is', net_diff, file=text_file)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[13\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    # Does the TB balance?
    with open("Report.txt", "a") as text_file:
        print('\nTB opening balance is unbalanced by', "%.2f" % tb['Balance b/f'].sum(), file=text_file)
        print('TB closing balance is unbalanced by',"%.2f" % tb['Balance c/f'].sum(), file=text_file)
        print('***If these are not 0 then the TB is certainly wrong and receiving a \nbalanced TB is the first step to reconciling all accounts***', file=text_file) 

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[14\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    diffs = Unreconciled.difference.abs().round().tolist()

    frequency = {}
    for w in diffs:
        frequency[w] = frequency.get(w, 0) + 1

    pairs = {x for x in frequency if x > 1} # dict comprehension to filter for pairs 
    with open("Report.txt", "a") as text_file:
        print('\nThere are', len(pairs), 'unreconciled accounts with equal and opposite differences', file=text_file)

</div>

</div>

</div>

</div>

</div>

<div class="cell border-box-sizing code_cell rendered">

<div class="input">

<div class="prompt input_prompt">

In \[15\]:

</div>

<div class="inner_cell">

<div class="input_area">

<div class="highlight hl-ipython3">

    with open('Report.txt', 'r') as fin:
        print(fin.read())

</div>

</div>

</div>

</div>

<div class="output_wrapper">

<div class="output">

<div class="output_area">

<div class="prompt">

</div>

<div class="output_subarea output_stream output_stdout output_text">

    The data contains 110 accounts
    99 accounts reconcile ( 90.0 %)

    11 accounts do not reconcile ( 10.0 %)
    There are 5 accounts in the GL and not in the TB. ( 45.45 % of unreconciled accounts)
    There are 6 accounts with journals missing ( 54.55 % of unreconciled accounts)
    The net of all the differences is 0.0

    TB opening balance is unbalanced by -2486.28
    TB closing balance is unbalanced by 1326.45
    ***If these are not 0 then the TB is certainly wrong and receiving a 
    balanced TB is the first step to reconciling all accounts***

    There are 3 unreconciled accounts with equal and opposite differences

</div>

</div>

</div>

</div>

</div>

    
    <div class="neighbors">
         <ul>
                 <li class="previous_article">
                     <a href="/spotify.html">
                         Spotify song history
                     </a>
                 </li>
             
                 <li class="next_article">
                     <a href="/fakegl-a-synthetic-general-ledger-and-trial-balance.html">
                         FakeGL - A synthetic General Ledger and Trial Balance
                     </a>
                 </li>
        </ul>
    </div>
        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <!--
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="/archives.html">Archives</a></li>
                            <li><a href="/tags.html">Tags</a></li>
                            <li><a href="/authors.html">Authors</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="#" target="_blank">You can add links in your config file</a></li>
                            <li><a href="#" target="_blank">Another social link</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
                            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
                            <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; blogname 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        -->
        <!-- /Footer -->
    </body>
</html>