<!DOCTYPE html>

<html class="" id="baz" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
      <![endif]-->
<title>FakeGL: A Synthetic General Ledger and Trial Balance - JohnMathews.eu</title>
<meta content="FakeGL: A Synthetic General Ledger and Trial Balance -  JohnMathews.eu " name="title"/>
<meta content="FakeGL: A Synthetic General Ledger and Trial Balance" property="og:title"/>
<meta content="FakeGL: A Synthetic General Ledger and Trial Balance" property="twitter:title"/>
<meta content=" Accounting,Data Analysis,Finance,General Ledger,Journals,Python,Reconciliation,Trial Balance " name="keywords"/>
<meta content="John Mathews" name="author"/>
<meta content="@johnmathews" name="twitter:creator"/>
<meta content=" My work involves processing a lot of General Ledgers and I wanted to build and test various automation and analytical techniques to see how my workflow could be improved. In order to do that in a... " name="description"/>
<meta content=" My work involves processing a lot of General Ledgers and I wanted to build and test various automation and analytical techniques to see how my workflow could be improved. In order to do that in a... " name="twitter:description"/>
<meta content=" My work involves processing a lot of General Ledgers and I wanted to build and test various automation and analytical techniques to see how my workflow could be improved. In order to do that in a... " property="og:description"/>
<meta content="https://johnmathews.eu/fakegl.html" property="og:url"/>
<meta content="https://johnmathews.eu/fakegl.html" property="twitter:url"/>
<meta content="https://johnmathews.eu/
" name="twitter:image"/>
<meta content="https://johnmathews.eu/
" property="og:image"/>
<meta content="  summary  " property="twitter:card"/>
<meta content="https://johnmathews.eu" name="twitter:domain"/>
<meta content=" article " property="og:type"/>
<link href="https://johnmathews.eu/extra/favicon.png" rel="icon"/>
<link href="https://johnmathews.eu/feeds/all.atom.xml" rel="alternate" title="John Mathews Feed" type="application/atom+xml"/>
<script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments);
          };
          ga.l = +new Date();
          ga("create", "UA-82253540-1", "auto");
          ga("send", "pageview");
        </script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cardo&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Anonymous+Pro&amp;display=swap" rel="stylesheet"/>
<script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>
<link href="https://johnmathews.eu/theme/css/styles.css" media="print" onload="this.media='all'" rel="stylesheet">
<link href="https://johnmathews.eu/theme/css/pygment-light.css" id="PygmentCSS" media="print" onload="this.media='all'" rel="stylesheet">
<script async="">
        let theme = localStorage.getItem('theme');
      </script>
<script>
        // dark mode light mode switcheroo
        const light = "https://johnmathews.eu/theme/css/pygment-light.css"
        const dark = "https://johnmathews.eu/theme/css/pygment-dark.css"
      </script>
<script src="https://johnmathews.eu/theme/js/navbar.js" type="text/javascript"></script>
<script src="https://johnmathews.eu/theme/js/themeChooser.js" type="text/javascript"></script>
<script>
        const indexURL = 'https://johnmathews.eu/fuse.html';
      </script>
<script defer="" src="https://johnmathews.eu/theme/js/fuseSearch.js" type="module"></script>
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css"/>
<style type="text/css">
      #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
  </style>
</link></link></head>
<body class="dark:bg-black">
<a class="pt-20 mt-20" name="top"></a>
<nav class="z-50 pt-2 text-xl top-0 w-full lg:fixed flex flex-row justify-between bg-white dark:bg-black" id="navbar" style="transition: top 0.3s ease-in-out;">
<div class="text-bold pr-3 hidden md:flex md:flex-grow xl:hidden">
<div class="mt-10 md:mt-0 flex-grow justify-between">
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/blog.html">Blog</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="javaScript:;" id="searchButton2">Search</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/about.html">About</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/experience.html">Experience</a>
</div>
<div class="flex-none justify-end px-2 pt-2">
<button aria-label="themeToggle" class="inline-block theme-toggle" id="modeSwitcher1" onclick="">
<div class="day modeIcon">
<i class="mb-2 pb-2 far fa-lightbulb fa-lg"></i>
</div>
<div class="night modeIcon hidden">
<i class="mb-2 pb-2 far fa-moon fa-lg"></i>
</div>
</button>
<button aria-label="Category chooser" class="catChooser hidden md:mt-0 ml-5 md:pl-0" id="">
<i class="mb-2 pb-2 fas fa-paw fa-lg"></i>
</button>
</div>
</div>
<div class="flex-none md:hidden block md:inline-block">
<button aria-label="Menu" class="mx-2 my-1" id="hamburger">
<div class="toggle"><i class="fas fa-bars fa-lg"></i></div>
<div class="hidden toggle"><i class="fas fa-times fa-lg"></i></div>
</button>
</div>
</nav>
<div class="toggle hidden w-screen flex flex-col text-left mt-5">
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/blog.html">Blog</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="javaScript:;" id="searchButton3">Search</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/about.html">About</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/experience.html">Experience</a>
<div class="px-3 pt-3 flex flex-row">
<button aria-label="themeToggle" class="mx-1 theme-toggle" id="modeSwitcher3" onclick="">
<div class="day modeIcon">
<i class="far fa-lightbulb fa-2x"></i>
</div>
<div class="night modeIcon hidden">
<i class="far fa-moon fa-2x"></i>
</div>
</button>
<button aria-label="Category chooser" class="catChooser hidden ml-5" id="">
<i class="fas fa-paw fa-2x"></i>
</button>
</div>
</div>
<main class="lg:mt-10 lg:pt-5 mx-auto md:w-5/6">
<div class="hidden fixed z-10 inset-0 overflow-y-auto" id="catModal">
<div class="flex items-end justify-center text-center min-h-screen pb-80 px-4 md:block md:p-0">
<div aria-hidden="true" class="fixed inset-0 transition-opacity">
<div class="absolute inset-0 bg-gray-500 opacity-75"></div>
</div>
<span aria-hidden="true" class="hidden sm:inline-block sm:align-middle md:h-screen">​</span>
<div aria-labelledby="modal-headline" aria-modal="true" class="inline-block align-bottom bg-white border-4 border-gray-50 rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle" role="dialog">
<div class="bg-gradient-to-t from-blue-300 to-yellow-300 px-5 py-5">
<div class="text-center">
<h3 class="text-2xl font-medium leading-8 md:leading-6 pb-2 text-gray-700" id="modal-headlinemd">
                  Which categories do you want to see?
                </h3>
<hr class="border -ml-6 -mr-6 border-blue-500 border-4 mt-2 mb-4"/>
<div class="flex items-center flex-row space-x-4 justify-center text-base my-auto text-gray-700" id="" role="group">
<button class="text-xl py-1 px-2 py-0 mx-0 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 border-0 outline-none focus:shadow-outline" id="chooseBoth">All</button>
<button class="text-xl py-1 px-2 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 outline-none focus:shadow-outline active:bg-red-500" id="chooseTechnical">Technical</button>
<button class="text-xl py-1 px-2 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 outline-none focus:shadow-outline" id="chooseNonTechnical">Non-Technical</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="hidden fixed z-10 inset-0 overflow-y-auto" id="fuseModal">
<div class="flex items-start justify-center text-center min-h-screen pb-80 px-4 md:block md:p-0">
<div aria-hidden="true" class="fixed inset-0 transition-opacity">
<div class="absolute inset-0 bg-gray-500 opacity-75" id="searchModalBackground"></div>
</div>
<span aria-hidden="true" class="hidden sm:inline-block sm:align-top md:h-screen">​</span>
<div aria-labelledby="modal-headline" aria-modal="true" class="w-full lg:w-10/12 lg:w-8/12 mt-5 lg:mt-20 inline-block align-bottom bg-white border-4 border-gray-50 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle" role="dialog">
<div class="py-1 px-1">
<input class="mt-5 mb-3 px-3 mb-5 w-full text-gray-800 text-xl font-semibold border-2 border-gray-200 rounded-lg" id="searchBox" style="outline:0;" type="text"/>
<div class="flex">
<div class="width-12 mx-1 px-2 text-gray-500 border border-gray-300 rounded-lg">
                  ctrl-k
                </div>
                or
                <div class="width-12 mx-1 px-2 text-gray-500 border border-gray-300 rounded-lg">
                  /
                </div>
</div>
<ul class="results text-lg text-bold text-gray-600" id="results">
</ul>
</div>
</div>
</div>
</div>

<div class="mx-auto w-full">
<div class="flex flex-row">
<div class="hidden xl:inline xl:w-32">
<div class="w-32">
<div class="mt-20 fixed flex flex-col">
<div class="lg:w-32">
<div>
<a class="my-2 prose prose-xl leading-8 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/index.html"><i class="far fa-md fa-star"></i></a>
</div>
<div>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/blog.html">Blog</a>
</div>
<div id="searchButton"> <a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="javaScript:;">Search</a> </div>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/about.html">About</a>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/experience.html">Experience</a>
<div class="flex my-2">
<button aria-label="themeToggle" class="md:pl-0 my-2 theme-toggle" id="modeSwitcher2" onclick="">
<div class="day modeIcon">
<i class="far fa-lightbulb fa-lg"></i>
</div>
<div class="night modeIcon hidden">
<i class="far fa-moon fa-lg"></i>
</div>
</button>
</div>
<div class="-mr-10 border-t-4 border-double border-gray-800 dark:border-gray-100 mt-20">
</div>
<div class="pt-20 font-serif text-lg text-gray-700 font-bold dark:text-gray-300">
    Published: <br/> January 2017
  </div>
<div class="pt-5 font-serif text-lg text-gray-700 font-bold dark:text-gray-300">
    Category:<br/>
<a href="https://johnmathews.eu/category/technical/data.html">Data</a>
</div>
</div>
</div>
</div>
</div>
<div class="w-full xl:w-5/6 xl:ml-20" id="contentParent">
<div class="mx-3 xl:ml-20 my-4 technical" id="articleParent">
<div class="mb-10">
<div class="markdown prose prose-md lg:prose-xl xl:prose-2xl leading-tight text-left mt-24 lg:-mr-30 xl:-mr-40 text-5xl md:text-6xl lg:text-8xl 2xl:text-9xl font-semibold lg:font-normal dark:text-gray-200" style="">
<span class="break-all" style="word-break: unset;">
          FakeGL: A Synthetic General Ledger and Trial Balance
        </span>
</div>
<div class="lg:hidden mt-20 text-lg font-serif font-bold text-gray-700 dark:text-gray-200">
        Category:
          <a href="https://johnmathews.eu/category/technical/data.html">Data</a>
</div>
<div class="lg:hidden text-lg font-serif font-light text-gray-600 dark:text-gray-200">
        January 2017
      </div>
</div>
<div class="mt-5 md:mt-20 md:mb-10 2xl:mt-40 2xl:mb-10 border-b-0 border-gray-600 dark:border-gray-200 border-double">
</div>
<main class="lg:w-4/6">
<article class="">
<div class="markdown">
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>My work involves processing a lot of General Ledgers and I wanted to build and test various automation and analytical techniques to see how my workflow could be improved. In order to do that in a free and fun way, I would need fake data, so I set out to build a process to generate a fake General Ledger (<span class="caps">GL</span>) and a corresponding Trial Balance (<span class="caps">TB</span>).</p>
<h2 id="Motivation-and-scope">Motivation and scope<a class="anchor-link" href="#Motivation-and-scope">¶</a></h2><p>Initially I didn’t know how comprehensive I needed the <span class="caps">GL</span> to be - modern systems are complex and store data for a wide variety of uses. I resolved to start with something simple and iterate for as long as I wanted.</p>
<p>The journals produced below satisfy the following general accounting principles:</p>
<ol>
<li>Each journal contains equal debits and credits</li>
<li>Opening and closing Trial Balances net to 0</li>
<li>Profit and Loss (P&amp;L) accounts start the year with 0 balance, Balance Sheet (<span class="caps">BS</span>) accounts do not.</li>
<li>Each transaction hits both the P&amp;L and the <span class="caps">BS</span> (i.e. If an account on the P&amp;L is credited, then the other side of the transaction is a debit to the <span class="caps">BS</span>)</li>
<li>Distinguish between manual and automatic journals </li>
</ol>
<p>The <span class="caps">GL</span>:</p>
<ol>
<li>Contains journals posted evenly throughout the year (this isnt realistic, but is a simple way to generate date data)</li>
<li>Receives journals from subledgers</li>
<li>Identifies if a journal is manual depending on which subledger it originated with</li>
<li>Records which user posted the journal if the journal is manual</li>
</ol>
<p>The script below allows the user to specify:</p>
<ol>
<li>The number of accounts on the <span class="caps">GL</span>/<span class="caps">TB</span></li>
<li>The number of journals in the <span class="caps">GL</span></li>
<li>A mean and variance for the number of lines in each journal</li>
<li>A mean and variance for the functional amounts posted to accounts</li>
<li>How many different users post manual journals</li>
<li>The beginning of the financial year</li>
<li>The criteria for a manual journal, based on subledger</li>
<li>The proportion of manuals which are manual</li>
<li>The proportion of accounts which hit the P&amp;L or <span class="caps">BS</span></li>
<li>An arbitrary list of subledgers</li>
</ol>
<p>The Jupyter Notebook below shows the annotated Python 3 code I wrote:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Notebook-set-up">Notebook set-up<a class="anchor-link" href="#Notebook-set-up">¶</a></h2><p>Load the various libraries used to easily add the required features. Two libraries to note:</p>
<ul>
<li>Pandas is pythons ubiquitous data handling tool</li>
<li>Faker is a useful tool to generate fake data, and is an easy way to bootstrap a database</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">gauss</span>
<span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Factory</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">natsort</span> <span class="kn">import</span> <span class="n">natsorted</span><span class="p">,</span> <span class="n">ns</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Choose-parameters-and-values-for-the-GL-and-TB">Choose parameters and values for the <span class="caps">GL</span> and <span class="caps">TB</span><a class="anchor-link" href="#Choose-parameters-and-values-for-the-GL-and-TB">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># ****** Number of different accounts in the GL *********</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">111</span> 


<span class="c1"># ****** Number of journals in the GL *******************</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">15713</span>

<span class="c1"># Setup posting date </span>
<span class="n">d0</span> <span class="o">=</span> <span class="s1">'20160101'</span> <span class="c1"># first day, data generated over 1 year.</span>
<span class="n">d1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>


<span class="c1"># ****** Distribution of lines per journals *************</span>
<span class="n">jl_1</span> <span class="o">=</span> <span class="mi">21</span> <span class="c1"># mean</span>
<span class="n">jl_2</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># variance</span>
<span class="n">j_l</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">gauss</span><span class="p">(</span><span class="n">jl_1</span><span class="p">,</span><span class="n">jl_2</span><span class="p">)))</span>


<span class="c1"># ****** Number of different users posting journals *****</span>
<span class="n">fake</span> <span class="o">=</span> <span class="n">Factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s1">'en_GB'</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ul</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">U</span><span class="p">):</span> <span class="n">ul</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>

<span class="c1"># ****** Functional amount values ***********************</span>
<span class="n">q1</span> <span class="o">=</span> <span class="mi">700</span> <span class="c1"># mean</span>
<span class="n">q2</span> <span class="o">=</span> <span class="mi">104</span> <span class="c1"># variance</span>
<span class="k">def</span> <span class="nf">q</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="c1"># True implies </span>
    <span class="k">if</span> <span class="n">p</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="nb">round</span><span class="p">(</span><span class="n">gauss</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>


<span class="c1"># ****** Proportion of journals which are manual ********</span>
<span class="n">Mp</span> <span class="o">=</span> <span class="mf">0.23</span>

<span class="c1"># ****** Proportion of accounts that are P&amp;L accounts ***</span>
<span class="n">Pp</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="c1"># ****** Subledger names *********</span>
<span class="n">source_feeds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'sl1'</span><span class="p">,</span><span class="s1">'sl2'</span><span class="p">,</span><span class="s1">'sl3'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions">¶</a></h2><p>Identify if an account feeds into the P&amp;L or <span class="caps">BS</span>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">isPandLaccount</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'P'</span>
        <span class="k">return</span> <span class="kc">False</span>
    
<span class="k">def</span> <span class="nf">isBSaccount</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'B'</span>
        <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generate account codes:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">account_names</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">b_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">p_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">a_names</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="n">p</span> <span class="o">=</span> <span class="s1">'ACP'</span>
    <span class="n">b</span> <span class="o">=</span> <span class="s1">'ACB'</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">Pp</span>
        <span class="k">if</span> <span class="n">A</span><span class="p">:</span> 
            <span class="n">y</span> <span class="o">=</span> <span class="n">b</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">b_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">y</span> <span class="o">=</span> <span class="n">p</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">p_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_names</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">del</span> <span class="n">b_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_names</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">del</span> <span class="n">p_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">a_names</span> <span class="o">=</span> <span class="n">b_names</span> <span class="o">+</span> <span class="n">p_names</span>
        
       
    <span class="k">return</span><span class="p">(</span><span class="n">a_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Generate journal names and lengths:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">journal_names</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>
    <span class="n">d0</span> <span class="o">=</span> <span class="s1">'20160101'</span> <span class="c1"># first day, data generated over 1 year.</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">a_n</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">):</span>   
        <span class="n">n</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">_"</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="s1">'J_'</span> <span class="o">+</span> <span class="n">n</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="o">/</span><span class="n">j</span><span class="p">)</span>
        <span class="n">a_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="n">j_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">el</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span> <span class="n">j_l</span><span class="p">(</span><span class="n">jl_1</span><span class="p">,</span><span class="n">jl_2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">))</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">a_n</span><span class="p">)</span> <span class="c1"># determine how many lines are in each journal. </span>
    <span class="k">return</span> <span class="n">j_names</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-the-list-of-journal-names-and-account-codes">Create the list of journal names and account codes<a class="anchor-link" href="#Create-the-list-of-journal-names-and-account-codes">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">j_names</span> <span class="o">=</span> <span class="n">journal_names</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> 
<span class="n">a_names</span> <span class="o">=</span> <span class="n">account_names</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-the-fake-General-Ledger-and-save-it-to-a-text-file">Create the fake General Ledger and save it to a text file<a class="anchor-link" href="#Create-the-fake-General-Ledger-and-save-it-to-a-text-file">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Output format</span>
<span class="n">glf</span> <span class="o">=</span> <span class="s1">'Journal_ID|Line|Type|Date|User|Account|Source|Functional_Currency|Functional_Amount'</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'gl.txt'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">glf</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">natsorted</span><span class="p">(</span><span class="n">j_names</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
    <span class="n">line_no</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># Assign each journal a source feed</span>
    <span class="n">source_id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">source_feeds</span><span class="p">)</span>
     
    <span class="c1"># Assign each journal a posting date   </span>
    <span class="n">posting_date</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="o">/</span><span class="n">j</span><span class="p">)</span>
      
    <span class="c1"># Make journal either M or A, if M assign user</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">Mp</span> <span class="c1"># True implies </span>
    <span class="n">p</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">U</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span> 
        <span class="n">man_ind</span> <span class="o">=</span> <span class="s1">'M'</span>
        <span class="n">u_name</span> <span class="o">=</span> <span class="n">ul</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">man_ind</span> <span class="o">=</span> <span class="s1">'A'</span>
        <span class="n">u_name</span> <span class="o">=</span> <span class="s1">''</span>
    
    <span class="c1"># Assign functional amount to each line</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j_names</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">line_no</span> <span class="o">=</span> <span class="n">line_no</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">line_no2</span> <span class="o">=</span> <span class="n">line_no</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">dr</span> <span class="o">=</span> <span class="n">q</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">)</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">dr</span>
        
        <span class="n">a_names_p</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">isPandLaccount</span><span class="p">,</span> <span class="n">a_names</span><span class="p">))</span>
        <span class="n">a_names_b</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="n">isBSaccount</span><span class="p">,</span> <span class="n">a_names</span><span class="p">))</span>

        <span class="n">an1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a_names_p</span><span class="p">)</span>  
        <span class="n">an2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a_names_b</span><span class="p">)</span>
        
        <span class="n">l_1</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_no</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">man_ind</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">posting_date</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">u_name</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">an1</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">source_id</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="s1">'GBP'</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dr</span><span class="p">)</span>
        <span class="n">l_2</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">line_no2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span><span class="n">man_ind</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">posting_date</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">u_name</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">an2</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="n">source_id</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="s1">'GBP'</span> <span class="o">+</span> <span class="s1">'|'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cr</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l_1</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l_2</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-the-Trial-Balance-and-save-it-to-a-text-file">Create the Trial Balance and save it to a text file<a class="anchor-link" href="#Create-the-Trial-Balance-and-save-it-to-a-text-file">¶</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Use gl to calc movement on each account</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'gl.txt'</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">'|'</span><span class="p">)</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">gl</span><span class="p">[[</span><span class="s1">'Account'</span><span class="p">,</span><span class="s1">'Functional_Amount'</span><span class="p">]]</span>

<span class="c1"># Calc net movement on each account</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'Account'</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tb</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tb</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Account'</span><span class="p">,</span><span class="s1">'Movement'</span><span class="p">]</span>
<span class="n">tb</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="s1">'Account'</span><span class="p">)</span>

<span class="c1"># Assign account type</span>
<span class="c1"># Set b/f balances to 0 for P&amp;L accounts</span>
<span class="n">tb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tb</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'P'</span><span class="p">,</span> <span class="s1">'Balance b/f'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tb</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'P'</span><span class="p">,</span> <span class="s1">'Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'P&amp;L'</span>
<span class="n">tb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tb</span><span class="o">.</span><span class="n">Account</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'B'</span><span class="p">,</span> <span class="s1">'Type'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'BS'</span>
<span class="n">tb</span><span class="p">[</span><span class="s1">'Balance dummy'</span><span class="p">]</span><span class="o">=</span><span class="n">tb</span><span class="p">[</span><span class="s1">'Balance b/f'</span><span class="p">]</span>

<span class="c1"># if b/f balance is != 0, generate a balance for that account</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">tb</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">'Balance dummy'</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">'Balance b/f'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">gauss</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">bal</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">gauss</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="s1">'Balance b/f'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bal</span>
        <span class="n">tb</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">'Balance b/f'</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">bal</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>    
<span class="k">del</span> <span class="n">tb</span><span class="p">[</span><span class="s1">'Balance dummy'</span><span class="p">]</span>

<span class="c1"># create c/f field</span>
<span class="n">tb</span><span class="p">[</span><span class="s1">'Balance c/f'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">tb</span><span class="p">[</span><span class="s1">'Balance b/f'</span><span class="p">]</span> <span class="o">+</span> <span class="n">tb</span><span class="p">[</span><span class="s1">'Movement'</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># create 'date of balance' column</span>
<span class="n">tb</span><span class="p">[</span><span class="s1">'Balance date'</span><span class="p">]</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># Arrange columns</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">tb</span><span class="p">[[</span><span class="s1">'Account'</span><span class="p">,</span> <span class="s1">'Type'</span><span class="p">,</span> <span class="s1">'Balance b/f'</span> <span class="p">,</span> <span class="s1">'Balance c/f'</span><span class="p">,</span> <span class="s1">'Balance date'</span><span class="p">]]</span>

<span class="c1"># print TB to file</span>
<span class="n">tb</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">'tb.txt'</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">'|'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-the-text-files-back-in-and-display-their-top-10-rows">Load the text files back in and display their top 10 rows<a class="anchor-link" href="#Load-the-text-files-back-in-and-display-their-top-10-rows">¶</a></h2><p>Verify that the files have been produced correctly and that the <span class="caps">TB</span> balances as expected</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">gl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'gl.txt'</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">'|'</span><span class="p">)</span>
<span class="n">tb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'tb.txt'</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">'|'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">tb</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[10]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Account</th>
<th>Type</th>
<th>Balance b/f</th>
<th>Balance c/f</th>
<th>Balance date</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td><span class="caps">ACB00003</span></td>
<td><span class="caps">BS</span></td>
<td>673.10</td>
<td>72348.68</td>
<td>20161231</td>
</tr>
<tr>
<th>1</th>
<td><span class="caps">ACB00007</span></td>
<td><span class="caps">BS</span></td>
<td>-673.10</td>
<td>20045.09</td>
<td>20161231</td>
</tr>
<tr>
<th>2</th>
<td><span class="caps">ACB00010</span></td>
<td><span class="caps">BS</span></td>
<td>748.16</td>
<td>-30340.79</td>
<td>20161231</td>
</tr>
<tr>
<th>3</th>
<td><span class="caps">ACB00012</span></td>
<td><span class="caps">BS</span></td>
<td>-748.16</td>
<td>188.39</td>
<td>20161231</td>
</tr>
<tr>
<th>4</th>
<td><span class="caps">ACB00015</span></td>
<td><span class="caps">BS</span></td>
<td>814.96</td>
<td>48294.11</td>
<td>20161231</td>
</tr>
<tr>
<th>5</th>
<td><span class="caps">ACB00017</span></td>
<td><span class="caps">BS</span></td>
<td>-814.96</td>
<td>10659.80</td>
<td>20161231</td>
</tr>
<tr>
<th>6</th>
<td><span class="caps">ACB00021</span></td>
<td><span class="caps">BS</span></td>
<td>835.56</td>
<td>18357.33</td>
<td>20161231</td>
</tr>
<tr>
<th>7</th>
<td><span class="caps">ACB00032</span></td>
<td><span class="caps">BS</span></td>
<td>-835.56</td>
<td>3406.80</td>
<td>20161231</td>
</tr>
<tr>
<th>8</th>
<td><span class="caps">ACB00034</span></td>
<td><span class="caps">BS</span></td>
<td>759.60</td>
<td>26505.40</td>
<td>20161231</td>
</tr>
<tr>
<th>9</th>
<td><span class="caps">ACB00036</span></td>
<td><span class="caps">BS</span></td>
<td>-759.60</td>
<td>-39128.80</td>
<td>20161231</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="n">gl</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt output_prompt">Out[11]:</div>
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Journal_ID</th>
<th>Line</th>
<th>Type</th>
<th>Date</th>
<th>User</th>
<th>Account</th>
<th>Source</th>
<th>Functional_Currency</th>
<th>Functional_Amount</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>J_20160101_1</td>
<td>1</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACP00054</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>-587.49</td>
</tr>
<tr>
<th>1</th>
<td>J_20160101_1</td>
<td>2</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACB00064</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>587.49</td>
</tr>
<tr>
<th>2</th>
<td>J_20160101_1</td>
<td>3</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACP00022</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>816.17</td>
</tr>
<tr>
<th>3</th>
<td>J_20160101_1</td>
<td>4</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACB00017</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>-816.17</td>
</tr>
<tr>
<th>4</th>
<td>J_20160101_1</td>
<td>5</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACP00088</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>628.60</td>
</tr>
<tr>
<th>5</th>
<td>J_20160101_1</td>
<td>6</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACB00062</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>-628.60</td>
</tr>
<tr>
<th>6</th>
<td>J_20160101_1</td>
<td>7</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACP00079</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>-672.34</td>
</tr>
<tr>
<th>7</th>
<td>J_20160101_1</td>
<td>8</td>
<td>M</td>
<td>20160101</td>
<td>Iain Gardiner</td>
<td><span class="caps">ACB00017</span></td>
<td>sl2</td>
<td><span class="caps">GBP</span></td>
<td>672.34</td>
</tr>
<tr>
<th>8</th>
<td>J_20160101_2</td>
<td>1</td>
<td>A</td>
<td>20160101</td>
<td>NaN</td>
<td><span class="caps">ACP00005</span></td>
<td>sl1</td>
<td><span class="caps">GBP</span></td>
<td>-683.52</td>
</tr>
<tr>
<th>9</th>
<td>J_20160101_2</td>
<td>2</td>
<td>A</td>
<td>20160101</td>
<td>NaN</td>
<td><span class="caps">ACB00036</span></td>
<td>sl1</td>
<td><span class="caps">GBP</span></td>
<td>683.52</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Net Opening TB:'</span><span class="p">,</span><span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">tb</span><span class="p">[</span><span class="s1">'Balance b/f'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Net Closing TB:'</span><span class="p">,</span><span class="s2">"</span><span class="si">%.2f</span><span class="s2">"</span> <span class="o">%</span> <span class="n">tb</span><span class="p">[</span><span class="s1">'Balance c/f'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Net Opening TB: 0.00
Net Closing TB: 0.00
</pre>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
</div>
</article>
</main>
<div class="border-t-2 border-double border-gray-300 mt-10 mb-10"></div>
<div class="mb-10 text-lg dark:text-gray-200">
<div class="flex flex-row">
<div class="text-red-500 dark:text-red-500"> ←  </div>
<a class="font-serif text-lg font-extrabold dark:text-gray-300 px-1 hover:text-red-500 dark:hover:text-red-500" href="https://johnmathews.eu/reconciliation.html"> Reconciliation of a trial balance to a general ledger</a>
</div>
<div class="flex flex-row mt-2">
<div class="text-green-500 dark:text-green-200"> → </div>
<a class="font-serif text-lg font-extrabold dark:text-gray-300 text-left px-1 hover:text-green-500 dark:hover:text-green-200" href="https://johnmathews.eu/books.html"> Analysing a personal library</a>
</div>
</div>
<div class="text-left">
<button class="inline-flex items-center h-10 px-5 text-gray-700 dark:text-gray-700 transition-colors duration-150 bg-yellow-500 hover:bg-yellow-600 rounded-lg focus:shadow-outline dark:hover:text-gray-200" id="signupButton">
<span>Subscribe</span>
<i class="py-2 pl-3 fas fa-lg fa-envelope"></i>
</button>
</div>
<div class="hidden" id="subscribeBox">
<!-- Begin Mailchimp Signup Form -->
<div id="mc_embed_signup">
<form action="https://johnmathews.us15.list-manage.com/subscribe/post?u=293155ea06a261f5255378dc0&amp;id=38c1e277b4" class="validate bg-white dark:bg-black" id="mc-embedded-subscribe-form" method="post" name="mc-embedded-subscribe-form" novalidate="" target="_blank">
<div id="mc_embed_signup_scroll">
<div class="mc-field-group dark:text-gray-300">
<label class="font-serif font-semibold text-lg" for="mce-EMAIL">Email Address </label>
<input class="required email dark:text-gray-800" id="mce-EMAIL" name="EMAIL" type="email" value=""/>
</div>
<div class="clear" id="mce-responses">
<div class="response" id="mce-error-response" style="display:none"></div>
<div class="response" id="mce-success-response" style="display:none"></div>
</div> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
<div aria-hidden="true" style="position: absolute; left: -5000px;">
<input name="b_293155ea06a261f5255378dc0_38c1e277b4" tabindex="-1" type="text" value=""/>
</div>
<div class="clear">
<input class="button" id="mc-embedded-subscribe" name="subscribe" type="submit" value="Subscribe"/>
</div>
</div>
</form>
</div>
<script src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js" type="text/javascript"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->
</div>
</div>
</div>
</div>
</div></main>
<footer class="footer w-5/6 mx-auto font-bold border-t-2 border-single border-gray-200 mt-10 py-3">
<div class="text-center font-serif text-lg text-gray-500 dark:text-gray-300">
<a class="px-3" href="https://johnmathews.eu/blog.html">Blog Posts</a> |
        <a class="px-3" href="#top">Back to top</a> |
        <a class="px-3" href="https://johnmathews.eu/categories.html">Categories</a> |
        <a class="px-3" href="https://johnmathews.eu/feeds/all.atom.xml">RSS</a>
</div>
</footer>
<div>
<!-- Note the usage of `type=module` here as this is an ES6 module -->
<script type="module">
          // Use ES module import syntax to import functionality from the module
          // that we have compiled.
          //
          // Note that the `default` import is an initialization function which
          // will "boot" the module and make it ready to use. Currently browsers
          // don't support natively imported WebAssembly as an ES module, but
          // eventually the manual initialization won't be required!
          // import { search, default as init } from './tinysearch_engine.js';
          import { search, default as init } from 'https://johnmathews.eu/tinysearch_engine.js';
        window.search = search;

        async function run() {
          // First up we need to actually load the wasm file, so we use the
          // default export to inform it where the wasm file is located on the
          // server, and then we wait on the returned promise to wait for the
          // wasm to be loaded.
          //
          // Note that instead of a string here you can also pass in an instance
          // of `WebAssembly.Module` which allows you to compile your own module.
          // Also note that the promise, when resolved, yields the wasm module's
          // exports which is the same as importing the `*_bg` module in other
          // modes
          await init('https://johnmathews.eu/tinysearch_engine_bg.wasm');
        }

        run();
        </script>
<script>
    // mailing list subscribe button
    document.getElementById("signupButton").addEventListener("click", function(e) {
      $('#signupButton').removeClass('block').addClass('hidden')
      $('#subscribeBox').removeClass('hidden').addClass('block')
    });
  </script>
<script>
    const technical = $( "#articleParent" ).hasClass('technical');
    const nonTechnical = $( "#articleParent" ).hasClass('nonTechnical');

    // if user preference for article category has been set and is contradicted by currenct article, update it
    if (localStorage.getItem('categoryChoice') === "technical") {
      if (nonTechnical) {
        window.localStorage.setItem('categoryChoice', 'all');
      };
    } else if (localStorage.getItem('categoryChoice') === "nonTechnical") {
      if (technical) {
        window.localStorage.setItem('categoryChoice', 'all');
      };
    } else if (localStorage.getItem('categoryChoice') === "all") {
      // do nothing
    } else {
      // if user preference for article category hasn't been set, assign it using article type
      if (technical) {
        window.localStorage.setItem('categoryChoice', 'technical');
      } else if (nonTechnical) {
        window.localStorage.setItem('categoryChoice', 'nonTechnical');
      };
    }
  </script>
</div>
</body>
</html>