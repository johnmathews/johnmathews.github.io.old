<!DOCTYPE html>

<html class="" id="baz" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
      <![endif]-->
<title>Adding Search - JohnMathews.eu</title>
<meta content="Adding Search -  JohnMathews.eu " name="title"/>
<meta content="Adding Search" property="og:title"/>
<meta content="Adding Search" property="twitter:title"/>
<meta content=" blog,search,tinysearch,web " name="keywords"/>
<meta content="John Mathews" name="author"/>
<meta content="@johnmathews" name="twitter:creator"/>
<meta content=" I’ve added search to this blog. Results are generated as you type. Try it by typing / or ctrl-k or cmd-k. If you look on the Pelican plugins index you’ll see that Tipue search is the only search... " name="description"/>
<meta content=" I’ve added search to this blog. Results are generated as you type. Try it by typing / or ctrl-k or cmd-k. If you look on the Pelican plugins index you’ll see that Tipue search is the only search... " name="twitter:description"/>
<meta content=" I’ve added search to this blog. Results are generated as you type. Try it by typing / or ctrl-k or cmd-k. If you look on the Pelican plugins index you’ll see that Tipue search is the only search... " property="og:description"/>
<meta content="https://johnmathews.eu/Adding-search.html" property="og:url"/>
<meta content="https://johnmathews.eu/Adding-search.html" property="twitter:url"/>
<meta content="https://johnmathews.eu/
" name="twitter:image"/>
<meta content="https://johnmathews.eu/
" property="og:image"/>
<meta content="  summary  " property="twitter:card"/>
<meta content="https://johnmathews.eu" name="twitter:domain"/>
<meta content=" article " property="og:type"/>
<link href="https://johnmathews.eu/extra/favicon.png" rel="icon"/>
<link href="https://johnmathews.eu/feeds/all.atom.xml" rel="alternate" title="John Mathews Feed" type="application/atom+xml"/>
<script>
          window.ga = window.ga || function () {
            (ga.q = ga.q || []).push(arguments);
          };
          ga.l = +new Date();
          ga("create", "UA-82253540-1", "auto");
          ga("send", "pageview");
        </script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" rel="stylesheet"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Cardo&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Anonymous+Pro&amp;display=swap" rel="stylesheet"/>
<script crossorigin="anonymous" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<link href="https://johnmathews.eu/theme/css/styles.css" rel="stylesheet">
<link href="https://johnmathews.eu/theme/css/pygment-light.css" id="PygmentCSS" media="print" onload="this.media='all'" rel="stylesheet">
<script>
        let theme = localStorage.getItem('theme');
      </script>
<script>
        // dark mode light mode switcheroo
        const light = "https://johnmathews.eu/theme/css/pygment-light.css"
        const dark = "https://johnmathews.eu/theme/css/pygment-dark.css"
      </script>
<script crossorigin="anonymous" src="https://johnmathews.eu/theme/js/themeChooser.js" type="text/javascript"></script>
</link></link></head>
<body class="dark:bg-black">
<a class="pt-20 mt-20" name="top"></a>
<nav class="d:fixed top-0 w-full flex flex-row justify-between pt-2 text-xl bg-white dark:bg-black" id="navbar" style="transition: top 0.3s ease-in-out;">
<div class="text-bold pr-3 hidden md:flex md:flex-grow xl:hidden">
<div class="mt-10 md:mt-0 flex-grow justify-between">
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/blog.html">Blog</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="javaScript:;" id="searchButton2">Search</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/about.html">About</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1" href="https://johnmathews.eu/experience.html">Experience</a>
</div>
<div class="flex-none justify-end px-2 pt-2">
<button aria-label="themeToggle" class="inline-block theme-toggle" id="modeSwitcher1">
<div class="day modeIcon">
<i class="mb-2 pb-2 far fa-lightbulb fa-lg"></i>
</div>
<div class="night modeIcon hidden">
<i class="mb-2 pb-2 far fa-moon fa-lg"></i>
</div>
</button>
<button aria-label="Category chooser" class="catChooser hidden md:mt-0 ml-5 md:pl-0" id="">
<i class="mb-2 pb-2 fas fa-paw fa-lg"></i>
</button>
</div>
</div>
<div class="flex-none md:hidden block md:inline-block">
<button aria-label="Menu" class="mx-2 my-1" id="hamburger">
<div class="toggle"><i class="fas fa-bars fa-lg"></i></div>
<div class="hidden toggle"><i class="fas fa-times fa-lg"></i></div>
</button>
</div>
</nav>
<div class="toggle hidden w-screen flex flex-col text-left mt-5">
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/blog.html">Blog</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="javaScript:;" id="searchButton3">Search</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/about.html">About</a>
<a class="text-gray-700 dark:text-gray-200 hover:underline font-semibold px-3 py-1 text-2xl" href="https://johnmathews.eu/experience.html">Experience</a>
<div class="px-3 pt-3 flex flex-row">
<button aria-label="themeToggle" class="mx-1 theme-toggle" id="modeSwitcher3">
<div class="day modeIcon">
<i class="far fa-lightbulb fa-2x"></i>
</div>
<div class="night modeIcon hidden">
<i class="far fa-moon fa-2x"></i>
</div>
</button>
<button aria-label="Category chooser" class="catChooser hidden ml-5" id="">
<i class="fas fa-paw fa-2x"></i>
</button>
</div>
</div>
<main class="lg:mt-10 lg:pt-5 mx-auto md:w-5/6">
<div class="hidden fixed z-10 inset-0 overflow-y-auto" id="catModal">
<div class="flex items-end justify-center text-center min-h-screen pb-80 px-4 md:block md:p-0">
<div aria-hidden="true" class="fixed inset-0 transition-opacity">
<div class="absolute inset-0 bg-gray-500 opacity-75"></div>
</div>
<span aria-hidden="true" class="hidden sm:inline-block sm:align-middle md:h-screen">​</span>
<div aria-labelledby="modal-headline" aria-modal="true" class="inline-block align-bottom bg-white border-4 border-gray-50 rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle" role="dialog">
<div class="bg-gradient-to-t from-blue-300 to-yellow-300 px-5 py-5">
<div class="text-center">
<h3 class="text-2xl font-medium leading-8 md:leading-6 pb-2 text-gray-700" id="modal-headlinemd">
                  Which categories do you want to see?
                </h3>
<hr class="border -ml-6 -mr-6 border-blue-500 border-4 mt-2 mb-4"/>
<div class="flex items-center flex-row space-x-4 justify-center text-base my-auto text-gray-700" id="" role="group">
<button class="text-xl py-1 px-2 py-0 mx-0 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 border-0 outline-none focus:shadow-outline" id="chooseBoth">All</button>
<button class="text-xl py-1 px-2 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 outline-none focus:shadow-outline active:bg-red-500" id="chooseTechnical">Technical</button>
<button class="text-xl py-1 px-2 bg-none rounded-xl hover:text-gray-50 hover:bg-yellow-500 outline-none focus:shadow-outline" id="chooseNonTechnical">Non-Technical</button>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="hidden fixed z-10 inset-0 overflow-y-auto" id="keyboardShortcuts">
<div class="flex items-end justify-center text-center min-h-screen pb-80 px-4 md:block md:p-0">
<div aria-hidden="true" class="fixed inset-0 transition-opacity">
<div class="absolute inset-0 bg-gray-500 opacity-75"></div>
</div>
<span aria-hidden="true" class="hidden sm:inline-block sm:align-middle md:h-screen">​</span>
<div aria-labelledby="modal-headline" aria-modal="true" class="inline-block align-bottom bg-white border-4 border-gray-50 rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle" role="dialog">
<div class="px-5 py-5">
<div class="">
<h3 class="text-2xl font-medium leading-8 md:leading-6 pb-2 text-gray-700" id="modal-headlinemd">
                 Keyboard Shortcuts:
                </h3>
<hr class=""/>
<div class="flex flex-row space-x-4 text-base text-gray-700" id="" role="group">
<ul>
<li>? - toggle shortcut descriptions</li>
<li>j - scroll down</li>
<li>k - scroll up</li>
<li>tt  - toggle dark theme</li>
<li>gi  - go to blog index page</li>
<li>gn  - go to next article</li>
<li>gp  - go to previous article</li>
<li>gb  - go to previous page</li>
<li>gf  - go forwards</li>
<li>gc  - go to categories page</li>
<li>gcc  - go to articles category page</li>
<li>ga  - go to about page</li>
<li>ge  - go to experience page</li>
<li>go  - go to portfolio page</li>
<li>gl  - go to landing page</li>
<li>ct - show only technical articles on index page</li>
<li>cn - show only non-technical articles on index page</li>
<li>ca - show articles from all categories on index page</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="hidden fixed z-10 inset-0 overflow-y-auto" id="fuseModal">
<div class="flex items-start justify-center text-center min-h-screen pb-80 px-4 md:block md:p-0">
<div aria-hidden="true" class="fixed inset-0 transition-opacity">
<div class="absolute inset-0 bg-gray-500 opacity-75" id="searchModalBackground"></div>
</div>
<div class="absolute inset-x-0 w-screen px-3">
<div aria-labelledby="modal-headline" aria-modal="true" class="w-full md:w-10/12 lg:w-8/12 mt-5 lg:mt-20 inline-block align-bottom bg-white border-4 border-gray-50 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle" role="dialog">
<div class="py-1 px-1">
<input class="mt-5 mb-3 px-3 mb-5 w-full text-gray-800 text-xl font-semibold border-2 border-gray-200 rounded-lg" id="searchBox" style="outline:0;" type="text"/>
<div class="hidden lg:inline-flex flex">
<div class="width-12 mx-1 px-2 text-gray-500 border border-gray-300 rounded-lg">
                    ctrl-k
                  </div>
                  or
                  <div class="width-12 mx-1 px-2 text-gray-500 border border-gray-300 rounded-lg">
                    /
                  </div>
</div>
<ul class="results text-lg text-bold text-gray-600" id="searchResults">
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="mx-auto w-full">
<div class="flex flex-row">
<div class="hidden xl:inline xl:w-32">
<div class="w-32">
<div class="mt-5 2xl:mt-20 fixed flex flex-col">
<div class="lg:w-32">
<div>
<a class="my-2 prose prose-xl leading-8 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/index.html"><i class="far fa-md fa-star"></i></a>
</div>
<div>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/blog.html">Blog</a>
</div>
<div id="searchButton"> <a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="javaScript:;">Search</a> </div>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/portfolio.html">Portfolio</a>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/about.html">About</a>
<a class="text-lg my-2 text-gray-700 dark:text-gray-200 hover:underline font-semibold block md:inline-block" href="https://johnmathews.eu/experience.html">Experience</a>
<div class="flex my-2">
<button aria-label="themeToggle" class="md:pl-0 my-2 theme-toggle" id="modeSwitcher2">
<div class="day modeIcon">
<i class="far fa-lightbulb fa-lg"></i>
</div>
<div class="night modeIcon hidden">
<i class="far fa-moon fa-lg"></i>
</div>
</button>
</div>
<div class="-mr-10 border-t-4 border-double border-gray-800 dark:border-gray-100 mt-20">
</div>
<div class="pt-20 font-serif text-lg text-gray-700 font-bold dark:text-gray-300">
    Published: <br/> March 2021
  </div>
<div class="pt-5 font-serif text-lg text-gray-700 font-bold dark:text-gray-300">
    Category:<br/>
<a href="https://johnmathews.eu/category/technical/web.html">Web</a>
</div>
</div>
</div>
</div>
</div>
<div class="w-full xl:w-5/6 xl:ml-20" id="contentParent">
<div class="mx-3 xl:ml-20 my-4 technical" id="articleParent">
<div class="mb-10">
<div class="markdown prose prose-md lg:prose-xl xl:prose-2xl leading-tight text-left mt-24 lg:-mr-30 xl:-mr-40 text-5xl md:text-6xl lg:text-8xl 2xl:text-9xl font-semibold lg:font-normal dark:text-gray-200" style="">
<span class="break-all" style="word-break: unset;">
          Adding Search
        </span>
</div>
<div class="lg:hidden mt-20 text-lg font-serif font-bold text-gray-700 dark:text-gray-200">
        Category:
          <a href="https://johnmathews.eu/category/technical/web.html">Web</a>
</div>
<div class="lg:hidden text-lg font-serif font-light text-gray-600 dark:text-gray-200">
        March 2021
      </div>
</div>
<div class="mt-5 md:mt-20 md:mb-10 2xl:mt-40 2xl:mb-10 border-b-0 border-gray-600 dark:border-gray-200 border-double">
</div>
<main class="lg:w-4/6">
<article class="">
<div class="markdown">
<p>I’ve added search to this blog. Results are generated as you type. Try it by
typing <code>/</code> or <code>ctrl-k</code> or <code>cmd-k</code>.</p>
<p>If you look on the Pelican <a href="https://github.com/pelican-plugins">plugins</a> index
you’ll see that <a href="https://github.com/pelican-plugins/tipue-search">Tipue search</a>
is the only search tool with a ready-made Pelican plugin, but unfortunately the
project seems to have died and the projects <a href="https://tipue.com/">website</a> is
now something else.</p>
<p>But searching a static site must be quite a common need and googling for
alternatives gave me a few choices. <a href="https://lunrjs.com/">Lunr.js</a> seems to be
the most popular, but it also seemed fairly complicated and like it was
probably more than I needed. I went with <a href="https://github.com/tinysearch/tinysearch">Tiny
Search</a> because it seemed to do what
I needed and was easy to setup. There’s even an example for
Pelican blogs.</p>
<p>One hurdle to success was minimising the false positives. The default settings
seem to prioritise keeping the size of the index small (tiny) over giving a
good user experience. Maybe its because the amount of text on my site is
significanly less, or more, than the typical use case. Either way, after
checking the project’s issues on Github I found an issue that matched my
problem perfectly. The solution is to increase the tiny_magic variable at build time.</p>
<p>According to the Readme, this requires using a container and building the index using <code>docker run...</code>. Unfortunately
the Dockerfile wouldn’t complete without errors. Checking the issues again and adding to the
discussion resulted in an alternative Dockerfile being suggested, which works.
Woohoo! I could then build the search index with a massive tiny_magic value (2048).</p>
<p>Then something weird happened. I write in Vim and I use <code>fzf</code> to find and open
files. I realised that <code>fzf</code> had stopped working. After some investigating, I
realised it was only not working in the blog project, and that <code>fzf.vim</code> calls
the <code>fzf</code> <span class="caps">CLI</span> tool, which in turn calls the <code>ripgrep</code> tool. The underlying
issue was that <code>ripgrep</code>  wasn’t working, and after a few hours (sob) of
debugging, I found out that one of the things that makes <code>rg</code> special is that
it ignores stuff in your .gitignore file. Sneakily, and without me  noticing,
the Docker image for constructing the tinysearch files had created a
.gitignore file with a single entry. The entry was *, which selects
everything. So <code>rg</code> was ignoring everything, and giving no results. Which
meant I couldn’t find and open files.</p>
<p>I still don’t know how (or which part of) the Dockerfile does this, so I’ve
created a .gitignore-master file which contains the correct content, and
after I generate a new search index I replace the new traitorous .gitignore
with the contents of .gitignore-master. I’ll come back to it later
when/if I have a better understanding of Dockerfile syntax, or Rust.</p>
<p>Adding search to the site made the content feel a lot closer and more
accessible. Once it was working I immediately wanted to use some keyboard
shortcuts to open the search box and select results. Kind of like
<a href="https://tailwindcss.com/">tailwindcss.com</a> does it. It feels really fast and precise.</p>
<p>Googling for some jquery packages, and also some vanilla javaScript showed me
enough to get things working. You can hit <code>/</code> or <code>ctrl-k</code> or <code>cmd-k</code> and bring up a search box
that populates results as you type!</p>
<p>Only whole words are matched unfortunately, but its still a super useful
feature. The search index includes article content as well as article titles
and categories. I’d like to tweak a few of the keyboard shortcut behaviours,
and add the contents of various pages (which aren’t articles) to the search index.</p>
</div>
</article>
</main>
<div class="mt-20 mb-10 text-lg dark:text-gray-200">
<div class="flex flex-row">
<div class="text-red-500 dark:text-red-500"> ←  </div>
<a class="font-serif text-lg font-extrabold dark:text-gray-300 px-1 hover:text-red-500 dark:hover:text-red-500" href="https://johnmathews.eu/different-views-for-different-users.html" id="previousArticleInCategory"> Different Views For Different Users</a>
</div>
<div class="mt-2 font-serif text-lg text-gray-700 font-bold dark:text-gray-300">
<div class="">
<a class="text-blue-600 dark:text-blue-300 font-serif text-lg font-bold" href="https://johnmathews.eu/category/technical/web.html" id="otherArticlesInCategory">Other articles in this category</a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
<footer class="footer w-5/6 mx-auto font-bold border-t-2 border-single border-gray-200 mt-10 py-3">
<div class="text-center font-serif text-lg text-gray-500 dark:text-gray-300">
<a class="px-3" href="https://johnmathews.eu/blog.html">Blog Posts</a> |
        <a class="px-3" href="#top">Back to top</a> |
        <a class="px-3" href="https://johnmathews.eu/categories.html">Categories</a> |
        <a class="px-3" href="https://johnmathews.eu/feeds/all.atom.xml">RSS</a>
</div>
</footer>
<script>
        const indexURL = 'https://johnmathews.eu/fuse.html';
        const siteURL = 'https://johnmathews.eu';
      </script>
<script crossorigin="anonymous" src="https://johnmathews.eu/theme/js/navbar.js" type="text/javascript"></script>
<script crossorigin="anonymous" src="https://johnmathews.eu/theme/js/fuseSearch.js" type="module"></script>
<script crossorigin="anonymous" src="https://johnmathews.eu/theme/js/keyboard-shortcuts.js" type="module"></script>
<script>
    const technical = $( "#articleParent" ).hasClass('technical');
    const nonTechnical = $( "#articleParent" ).hasClass('nonTechnical');

    // if user preference for article category has been set and is contradicted by currenct article, update it
    if (localStorage.getItem('categoryChoice') === "technical") {
      if (nonTechnical) {
        window.localStorage.setItem('categoryChoice', 'all');
      };
    } else if (localStorage.getItem('categoryChoice') === "nonTechnical") {
      if (technical) {
        window.localStorage.setItem('categoryChoice', 'all');
      };
    } else if (localStorage.getItem('categoryChoice') === "all") {
      // do nothing
    } else {
      // if user preference for article category hasn't been set, assign it using article type
      if (technical) {
        window.localStorage.setItem('categoryChoice', 'technical');
      } else if (nonTechnical) {
        window.localStorage.setItem('categoryChoice', 'nonTechnical');
      };
    }
  </script>
</body>
</html>